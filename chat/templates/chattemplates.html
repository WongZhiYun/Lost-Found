<!DOCTYPE html>
<html>
<head>
  <title>Chat with {{ other_user }}</title>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: auto;
      padding: 5px;
      margin-bottom: 10px;
    }
    .message {
      margin: 4px 0;
    }
    .message b {
      color: #333;
    }
    .status {
      color: gray;
      font-style: italic;
    }
    #message {
      width: 70%;
      padding: 5px;
    }
    button {
      padding: 6px 12px;
    }
  </style>
</head>
<body>
  <h2>Chat with {{ other_user }}</h2>

  <div id="chat-box"></div>

  <input id="message" type="text" placeholder="Type message...">
  <button onclick="sendMessage()">Send</button>

  <br><br>
  <a href="{{ url_for('home') }}">Back to Home</a>

  <script>
    var socket = io();
    var room = "{{ room }}";
    var username = "{{ current_user }}";

    // join chat room
    socket.emit("join", {username: username, room: room});

    // display new messages
    socket.on("message", function(data) {
      var chatBox = document.getElementById("chat-box");
      var msgDiv = document.createElement("div");
      msgDiv.classList.add("message");
      msgDiv.innerHTML = "<b>" + data.user + ":</b> " + data.msg;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    // display status updates (user joined, left, etc.)
    socket.on("status", function(data) {
      var chatBox = document.getElementById("chat-box");
      var statusDiv = document.createElement("div");
      statusDiv.classList.add("status");
      statusDiv.textContent = data.msg;
      chatBox.appendChild(statusDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    // send message to server
    function sendMessage() {
      var input = document.getElementById("message");
      var msg = input.value.trim();
      if (msg !== "") {
        socket.emit("message", {username: username, msg: msg, room: room});
        input.value = "";
      }
    }

    // press Enter to send
    document.getElementById("message").addEventListener("keyup", function(event) {
      if (event.key === "Enter") {
        sendMessage();
      }
    });
  </script>
</body>
</html>
